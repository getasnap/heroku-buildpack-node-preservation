#!/usr/bin/env bash
# bin/compile BUILD_DIR CACHE_DIR ENV_DIR

BUILD_DIR=$1
CACHE_DIR=${2:-}
ENV_DIR=${3:-}

BP_DIR=$(cd "$(dirname "${0:-}")"; cd ..; pwd)

echo "Build Dir ${BUILD_DIR}"
echo "BP_DIR ${BP_DIR}"
echo "HOME ${HOME}"
which node
which mjml

# Setting environment variables in .profile.d script (sourced at dyno startup)
echo "-----> Preserving Node Environment Variables"
mkdir -p "$BUILD_DIR"/.profile.d
cat <<EOF >"$BUILD_DIR"/.profile.d/heroku-buildpack-node-preservation.sh
PATH=$PATH:$HOME/.heroku/node/bin:$HOME/node_modules/.bin/
EOF

echo "-----> Done"
exit 0

echo "-----> Node Environment Preserved"
